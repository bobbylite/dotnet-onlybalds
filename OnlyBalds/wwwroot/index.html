<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<title>Only Balds</title>
	<meta name="keywords" content="">
	<meta name="description" content="">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

	<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->   
	
    <link rel="icon" href="/favicon.png" />
	<link rel="icon" href="/images/favicon-16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="/images/favicon-32.png" sizes="32x32" type="image/png">
	<link rel="icon" href="/images/favicon-48.png" sizes="48x48" type="image/png">
	<link rel="icon" href="/images/favicon-62.png" sizes="62x62" type="image/png">
	<link rel="apple-touch-icon" href="/apple-touch-icon.png">
	<meta property="og:url" content="https://example.com/page.html">
	<meta property="og:type" content="website">
	<meta property="og:title" content="Content Title">
	<meta property="og:image" content="https://example.com/image.jpg">
	<meta property="og:description" content="Description Here">
	<meta property="og:site_name" content="Site Name">
	<meta property="og:locale" content="en_US">

    <link rel="stylesheet" href="/app.css"/>

	<link rel="stylesheet" href="/assets/styles/styles-1d9c2d7206.css"/>

	<script src="/assets/scripts/Vendor-07ad14d4d0.js"></script>

    <style>
        html, body {
            overflow-y: scroll;
        }
        .custom-toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: #1f2937;
            color: #f9fafb;
            padding: 14px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            font-size: 15px;
            z-index: 9999;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            transition: all 0.4s ease;
        }
        .custom-toast.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
            cursor: pointer;
        }
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.6);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content.loading-popup {
            background: #fff;
            padding: 30px 40px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
        }
        .spinner {
            margin: 0 auto 15px auto;
            width: 48px;
            height: 48px;
            border: 5px solid #ddd;
            border-top-color: #007bff; /* Blue spinner */
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loading-text {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        /* Spinner animation */
        @keyframes spin {
        to { transform: rotate(360deg); }
        }
    </style>

</head>
<body>

	<!-- COMMENT
	================================================== -->
	<div class="navbar">
		<div class="navbar__left">
			<button class="navbar__logo">
                <img src="/assets/images/logo.png" alt="Only Balds" >
            </button>
		</div>
		<nav class="navbar__nav">
			<ul class="nav main-nav">
				<li class="nav__item"><button class="nav__link about">About</button></li>
				<li class="nav__item"><button class="nav__link forum">Forum</button></li>
				<li class="nav__item"><button class="nav__link chat-room">Chat Room</button></li>
				<li class="nav__item"><button class="nav__link marketplace">Marketplace</button></li>
				<li class="nav__item dropdown">
					<a href="#" class="nav__link dropdown__toggle" role="button">Social
						<i class="fa fa-angle-down dropdown__toggle-icon"></i>
					</a>
					<ul class="dropdown__nav">
                        <li class="dropdown__item"><a href="https://www.instagram.com/onlybaldsllc/" class="dropdown__link dropdown__link--icon" target="_blank"><i class="fa fa-instagram"></i> Instagram</a></li>

                        <li class="dropdown__item">
                        <a href="https://www.tiktok.com/@Onlybaldsz" class="dropdown__link dropdown__link--icon" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 48 48" style="vertical-align: middle;">
                            <path d="M41.9 17.6c-2.9.1-5.7-1-7.9-2.9V25c0 8.1-6.6 14.7-14.7 14.7S4.6 33.1 4.6 25s6.6-14.7 14.7-14.7c1.2 0 2.4.2 3.6.5v7.5c-.9-.3-1.9-.4-2.9-.4-4.1 0-7.4 3.3-7.4 7.4S15.9 33 20 33c3.6 0 6.7-2.6 7.3-6.1 0-.4.1-.9.1-1.3V4h7.5c.3 2.6 1.6 5 3.6 6.8 1.7 1.5 3.8 2.5 6.1 2.8v7.9h-.1z"/>
                            </svg>
                            TikTok
                        </a>
                        </li>

                        <li class="dropdown__item">
                        <a href="https://twitter.com/onlybaldsllc" class="dropdown__link dropdown__link--icon" target="_blank">
                            <i class="fa fa-twitter"></i> X / Twitter
                        </a>
                        </li>

                        <li class="dropdown__item">
                        <a href="https://www.reddit.com/user/Onlybalds" class="dropdown__link dropdown__link--icon" target="_blank">
                            <i class="fa fa-reddit-square"></i> Reddit
                        </a>
                        </li>

                        <li class="dropdown__item">
                        <a href="mailto:boldbaldiesbiz@gmail.com" class="dropdown__link dropdown__link--icon">
                            <i class="fa fa-envelope"></i> Email
                        </a>
                        </li>
					</ul>
				</li>
			</ul>
		</nav>
		<div class="navbar__right dropdown">
			<a href="#" class="navbar__user-dropdown">
                <div class="navbar__user-profile-abbrev">
                    <div class="navbar__user-profile-abbrev-text">
                        <svg xmlns="http://www.w3.org/2000/svg" style="margin-top: 5px;" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                            <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                        </svg>
                    </div>
                </div> 
                <span class="navbar__mobile-hide">My </span>Account <i class="fa fa-angle-down dropdown__toggle-icon"></i>
            </a>
            <ul id="menu-options" class="dropdown__nav dropdown__nav--user">
                <li class="dropdown__item dropdown__item--title greeting"></li>
                <li class="dropdown__item complete-signup">
                    <button class="dropdown__link dropdown__link--icon finish-signup" style="width: 100%;">
                        <i class="fa fa-edit"></i> 
                        Complete Signup
                    </button>
                </li>
                <li class="dropdown__item sign-in">
                    <a href="/auth/login" class="dropdown__link dropdown__link--icon">
                        <i class="fa fa-sign-in"></i> 
                        Sign In
                    </a>
                </li>
            </ul>
            <div class="navbar__mobile-buttons">
                <button class="navbar__toggle navicon">
                    <div class="navicon__holder">
                        <div class="navicon__line"></div>
                        <div class="navicon__line"></div>
                        <div class="navicon__line"></div>
                    </div>
                </button>
            </div> 
		</div>
	</div><!--/comment -->

    <div id="component-placeholder" style="background-color: white;">
        <div id="spinner-holder" class="box__holder" style="margin-top:100px; margin-bottom: 500px; height:auto; min-height: 400px;">
            <div class="flex-center">
                <div class="spinner-border" role="status" aria-label="Loading"></div>
            </div>
        </div>
    </div>

	<div class="footer" style="display: none;">
        <div class="container">
            <div class="footer__buttons">
                <ul class="footer__button-links">
                    <li><button class="btn btn--rounded btn--faded forum">Forum</button></li>
                    <li><button class="btn btn--rounded btn--faded chat-room">Chat Room</button></li>
                    <li><button class="btn btn--rounded btn--faded marketplace">Marketplace</button></li>
                    <li class="footer__right-list-item"><a href="/auth/login" class="btn btn--rounded btn--white">Become A Member</a></li>
            </div>
        </div>
        <img src="/assets/images/only-balds-face-icon.png" alt="" aria-hidden="true" class="footer__face-icon">
    </div>

    <!-- MODAL OVERLAY -->
    <div id="loading-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content loading-popup">
        <div class="spinner"></div>
        <div class="loading-text">Verifying identity information...</div>
    </div>
    </div>


    <div id="custom-toast" class="custom-toast">You can only perform that action on your own post</div>

    <script src="/assets/scripts/App-5379555225.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>

    <script>
        var user = {};

        $(() => {
            var urlParams = new URLSearchParams(window.location.search);
            var message = urlParams.get('message');
            var success = urlParams.get('success');

            if (message && success) {
                if (success === "true") {
                    $("#loading-modal").fadeIn();
                    $('#spinner-holder').remove();
                    
                    $.ajax({
                        url: '/refresh-token',
                        method: 'GET',
                        success: function(data) {
                            console.log('Token refreshed:', data);

                            var user = data;
                            var account = data.account;
                            window.loggedInUser = user;

                            $(".sign-in").remove();
                            $(".greeting").empty().append(`Hi, ${user.name}`);
                            $("#menu-options").append(`
                                <li class="dropdown__item sign-out">
                                    <a href="/auth/logout" class="dropdown__link dropdown__link--icon">
                                        <i class="fa fa-sign-out"></i> 
                                        Sign Out
                                    </a>
                                </li>
                            `);
                            
                            window.app.scripts.showToast(message);
                            $("#loading-modal").fadeOut();

                            if (user.claims.email_verified === "true" && (account === null || account === undefined)) {
                                //window.app.scripts.loadFinishSignUp();
                                window.location.href = '/auth/login';
                                return;
                            }

                            if (user.claims.email_verified === "false") {
                                console.log("Email not verified, redirecting to verify page.");
                                window.app.scripts.loadVerify();
                                return;
                            }

                            if (user.claims.email_verified === "true" && (account === null || account === undefined)) {
                                window.app.scripts.loadFinishSignUp();
                                return;
                            }

                            if (account.hasSubmittedQuestionnaire !== true) {
                                window.app.scripts.loadFinishSignUp();
                                return;
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error('Failed to refresh token:', error);
                        }
                    });
                } else {
                    window.app.scripts.showToast("Error: " + message);
                }
            }
            else {
                bootstrapPage();
            }
        });

        const bootstrapPage = () => {
            $.ajax({
                url: "/identity-information",
                method: "GET",
                success: function (data) {
                    user = data;

                    let userName = user.name;
                    console.log("User data:", user);
                    console.log("User name:", userName);
                    $(".sign-in").remove();
                    $(".greeting").empty().append(`Hi, ${userName}`);
                    $("#menu-options").append(`
                        <li class="dropdown__item sign-out">
                            <a href="/auth/logout" class="dropdown__link dropdown__link--icon">
                                <i class="fa fa-sign-out"></i> 
                                Sign Out
                            </a>
                        </li>
                    `);

                    var account = user.account;

                    console.log("User claims:", user.claims);
                    console.log("User account:", account);

                    if (user.claims.email_verified === "true" && (account === null || account === undefined)) {
                        window.app.scripts.loadFinishSignUp();
                        return;
                    }

                    if (user.claims.email_verified === "false") {
                        console.log("Email not verified, redirecting to verify page.");
                        window.app.scripts.loadVerify();
                        return;
                    }

                    if (user.claims.email_verified === "true" && (account === null || account === undefined)) {
                        window.app.scripts.loadFinishSignUp();
                        return;
                    }

                    if (account.hasSubmittedQuestionnaire !== true) {
                        window.app.scripts.loadFinishSignUp();
                        return;
                    }
                    
                    window.app.scripts.loadHome();
                    $(".complete-signup").remove();
                },
                error: function (xhr, status, error) {
                    console.log("Error fetching user data:", error);
                    
                    window.app.scripts.loadHome();
                    $(".complete-signup").remove();
                }
            });

            window.onpopstate = function(event) {
                window.app.scripts.loadComponent(event.state.component, event.state.componentPlaceholder);
            };
        }
    </script>

    <script>
        $(() => {
            registerHome();
            registerSignUp();
            registerAbout();
            registerForum();
            registerChatRoom();
            registerMarketplace();
        });

        const registerSignUp = () => {
            $('.finish-signup').on('click', function (e) {
                e.preventDefault();

                emptyComponents();

                let isAuthorizedForPage = window.app.scripts.isAuthorizedForPage();
                if (!isAuthorizedForPage) {
                    return;
                }

                window.app.scripts.loadFinishSignUp();
            });
        };

        const registerAbout = () => {
            $('.about').on('click', function (e) {
                e.preventDefault();
                
                emptyComponents();

                window.app.scripts.loadAbout();
            });
        };

        const registerHome = () => {
            $('.navbar__logo').on('click', function (e) {
                e.preventDefault();

                emptyComponents();
                window.app.scripts.loadHome();
            });
        };

        const registerForum = () => {
            $('.forum').on('click', function (e) {
                e.preventDefault();

                emptyComponents();

                let isAuthorizedForPage = window.app.scripts.isAuthorizedForPage();
                if (!isAuthorizedForPage) {
                    return;
                }

                window.app.scripts.loadForum();
            });
        };

        const registerChatRoom = () => {
            $('.chat-room').on('click', function (e) {
                e.preventDefault();

                emptyComponents();

                let isAuthorizedForPage = window.app.scripts.isAuthorizedForPage();
                if (!isAuthorizedForPage) {
                    return;
                }

                window.app.scripts.loadChatRoom();
            });
        };

        const registerMarketplace = () => {
            $('.marketplace').on('click', function (e) {
                e.preventDefault();

                emptyComponents();

                window.app.scripts.loadMarketplace();
            });
        };

        function closeNavbar() {
            $('.navbar__nav').removeClass('navbar__nav--is-open');
            $('.navbar__toggle').removeClass('navicon--toggle');
        }

        function emptyComponents() {            
            window.state = 
            {
                isUserOnline: false
            }
        }

    </script>

    <script>
        window.app = window.app || {};
        window.app.scripts = {
            updateQueryParam: (key, value) => {
                console.log("Updating query param:", key, value);
                const url = new URL(window.location.href);

                for (const param of Array.from(url.searchParams.keys())) {
                    url.searchParams.delete(param);
                }

                url.searchParams.set(key, value);
                console.log("Updated URL:", url.toString());
                window.history.replaceState(history.state, '', url);
            },
            clearQueryParams: () => {
                var urlParams = new URLSearchParams(window.location.search);
                
                urlParams.delete('postId');
                urlParams.delete('threadId');

                var newQuery = urlParams.toString();
                var newUrl = `${window.location.pathname}${newQuery ? '?' + newQuery : ''}${window.location.hash}`;
                window.history.replaceState({}, document.title, newUrl);
            },
            loadComponent: (component, componentPlaceholder, queryKey, queryValue) => {
                if (component.includes('forum') === false)
                {
                    window.app.scripts.clearQueryParams();
                }

                emptyComponents();
                $('.footer').hide();

                let url = new URL(window.location.href);

                if (queryKey && queryValue) {
                    url.searchParams.set(queryKey, queryValue);
                }

                $(`#component-placeholder`).load(`components/${component}.html`, function () {
                    history.pushState(
                        { component, componentPlaceholder },
                        null,
                        url.toString()
                    );
                });

                $('.footer').fadeIn(400);
                closeNavbar();
            },
            loadAbout: () => window.app.scripts.loadComponent('about', 'about-placeholder'),
            loadHome: () => window.app.scripts.loadComponent('home', 'home-placeholder'),
            loadForum: () => window.app.scripts.loadComponent('forum', 'forum-placeholder'),
            loadChatRoom: () => window.app.scripts.loadComponent('chat-room', 'chat-room-placeholder'),
            loadMarketplace: () => window.app.scripts.loadComponent('marketplace', 'marketplace-placeholder'),
            loadNewPost: () => window.app.scripts.loadComponent('forum-new-post', 'new-post-placeholder'),
            loadFinishSignUp: () => window.app.scripts.loadComponent('finish-signup', 'finish-signup-placeholder'),
            loadVerify: () => window.app.scripts.loadComponent('verify', 'verify-placeholder'),
            loadUnauthorized: () => window.app.scripts.loadComponent('unauthorized', 'unauthorized-placeholder'),
            registerReadPostClick: (postId) => {
                $(`.read-post-${postId}`).on('click', function (e) {
                    e.preventDefault();

                    console.log("Read post clicked:", postId);

                    window.app.scripts.loadComponent('forum-single', 'read-post-placeholder', 'postId', postId);
                });
            },
            registerNewPostClick: () => {
                $('.write-new-post').on('click', function (e) {
                    e.preventDefault();

                    console.log("New post clicked");

                    window.app.scripts.loadComponent('forum-new-post', 'new-post-placeholder');
                    
                });
            },
            isAuthorizedForPage: () => {
                if (typeof user.isAuthenticated === "undefined")
                {
                    window.app.scripts.loadUnauthorized();
                    return false;
                }
        
                console.log("Authorized User:", user);
                return true;
            },
            showToast: (message) => {
                const $toast = $('#custom-toast');
                $toast.text(message).addClass('show');

                const timeout = setTimeout(() => {
                    $toast.removeClass('show');
                }, 3000);

                $toast.one('click', function () {
                    clearTimeout(timeout);
                    $(this).removeClass('show');
                });
            }
        };
    </script>
</body>
</html>