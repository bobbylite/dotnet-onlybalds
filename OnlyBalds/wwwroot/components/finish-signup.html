<!-- BANNER
============================================== -->
<div class="banner banner--fade-to-gray">
    <div class="container">
        <h1 class="banner__heading" data-aos="fade-up" data-aos-delay="100" data-aos-offset="0">Welcome to OnlyBalds</h1>
        <p class="lead banner__paragraph" data-aos="fade-up" data-aos-delay="200" data-aos-offset="0">
            Thanks for signing up! You're just a few clicks away from joining a supportive community navigating their balding journeys together.
            Fill out the quick questionnaire below to personalize your experience and set up your profile.
        </p>
    </div>
</div><!--/banner -->

<!-- BALDIE QUESTIONNAIRE
============================================== -->
<div class="section section--gray">
    <div class="container">
        <div class="box box--with-top-lines"  data-aos="fade-up" data-aos-delay="150" data-aos-offset="0">
            <div class="box__top-line box__top-line--light-blue"></div>
            <div class="box__top-line box__top-line--blue"></div>
            <div class="box__holder">
                <div class="box__section box__section--chat-frame">
                    <form action="" id="baldie-questionnaire">
                        <div class="grid">
                            <!-- First Name -->
                            <div class="grid__column grid__column--12 grid__column--6--md control">
                                <label for="firstName" class="control__label">What is your first name?</label>
                                <input type="text" id="firstName" name="firstName" class="control__input required-input">
                            </div>

                            <!-- Last Name -->
                            <div class="grid__column grid__column--12 grid__column--6--md control">
                                <label for="lastName" class="control__label">What is your last name?</label>
                                <input type="text" id="lastName" name="lastName" class="control__input required-input">
                            </div>

                            <!-- Display Name -->
                            <div class="grid__column grid__column--12 grid__column--6--md control">
                                <label for="displayName" class="control__label">What would you like us to call you?</label>
                                <input type="text" id="displayName" name="displayName" class="control__input required-input">
                            </div>

                            <!-- Address -->
                            <div class="grid__column grid__column--12 grid__column--6--md control">
                                <label for="address" class="control__label">What is your current address?</label>
                                <input type="text" id="address" name="address" class="control__input required-input" autocomplete="on">
                            </div>

                            <!-- Bald Type -->
                            <div class="grid__column grid__column--12 control">
                                <h2 class="control__heading">Tell Us About Your Bald Life</h2>
                            </div>
                            <div class="grid__column grid__column--12 grid__column--12--md control">
                                <label for="baldType" class="control__label">What type of Baldie are you?</label>
                                <select class="select control__input required-input" id="baldType" name="baldType">
                                    <option value="select">Select An Option</option>
                                    <option value="veteran">Veteran</option>
                                    <option value="denier">Denier</option>
                                    <option value="rookie">Rookie/Newbie</option>
                                    <option value="beard">Beard Baldie</option>
                                </select>
                            </div>

                            <!-- Bald Head Cleaning -->
                            <div class="grid__column grid__column--12 control">
                                <label class="control__label">
                                    How do you keep your bald head clean? <small>(Select all that apply)</small>
                                </label>
                                <ul class="control" style="list-style: none; padding: 0; margin: 0;">
                                    <li>
                                        <label>
                                            <input type="checkbox" name="cleaningMethods" value="Buzz it down with clippers">
                                            Buzz it down with clippers
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="cleaningMethods" value="Disposable razors">
                                            Disposable razors
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="cleaningMethods" value="High-end razors">
                                            High-end razors
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="cleaningMethods" value="Shave with cleanser before/after">
                                            Shave with cleanser before/after
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="cleaningMethods" value="Shaving cream or gel">
                                            Shaving cream or gel
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="cleaningMethods" value="Just bar soap">
                                            Just bar soap
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="cleaningMethods" value="Other">
                                            Other:
                                            <input type="text" name="cleaningMethodsOther" class="control__input">
                                        </label>
                                    </li>
                                </ul>
                            </div>


                            <!-- Bald Care Routine -->
                            <div class="grid__column grid__column--12 control">
                                <label for="baldCareRoutine" class="control__label">Describe your bald care routine</label>
                                <textarea id="baldCareRoutine" name="baldCareRoutine" class="control__input required-input" rows="3"></textarea>
                            </div>

                            <!-- Products Used -->
                            <div class="grid__column grid__column--12 control">
                                <label for="productsUsed" class="control__label">What products do you use regularly for shaving or scalp care?</label>
                                <textarea id="productsUsed" name="productsUsed" class="control__input required-input" rows="3"></textarea>
                            </div>

                            <!-- Monthly Spend -->
                            <div class="grid__column grid__column--12 control">
                                <label class="control__label">How much do you spend per month on bald-related products or grooming?</label>
                                <select class="select control__input required-input" id="monthlySpend" name="monthlySpend">
                                    <option value="select">Select An Option</option>
                                    <option value="under10">Under $10/month</option>
                                    <option value="10-30">$10–30/month</option>
                                    <option value="30-50">$30–50/month</option>
                                    <option value="50plus">$50+/month</option>
                                    <option value="notSure">Not sure</option>
                                </select>
                            </div>

                            <!-- Confidence Level -->
                            <div class="grid__column grid__column--12 control">
                                <label class="control__label">How confident do you feel about being bald?</label>
                                <select class="select control__input required-input" id="confidenceLevel" name="confidenceLevel">
                                    <option value="select">Select An Option</option>
                                    <option value="superConfident">Super confident</option>
                                    <option value="prettyGood">Pretty good</option>
                                    <option value="meh">Meh, working on it</option>
                                    <option value="notConfidentYet">Not confident yet</option>
                                </select>
                            </div>

                            <!-- Interests -->
                            <div class="grid__column grid__column--12 control">
                                <label class="control__label">
                                    Are you interested in any of the following? <small>(Select all that apply)</small>
                                </label>
                                <ul class="control" style="list-style: none; padding: 0; margin: 0;">
                                    <li>
                                        <label>
                                            <input type="checkbox" name="interests" value="Hair transplant">
                                            Hair transplant
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="interests" value="Scalp micropigmentation">
                                            Scalp micropigmentation
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="interests" value="Hair growth meds/treatments">
                                            Hair growth meds/treatments
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="interests" value="Just owning the bald life">
                                            Just owning the bald life
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="interests" value="Not sure yet">
                                            Not sure yet
                                        </label>
                                    </li>
                                </ul>
                            </div>

                            <!-- Goals -->
                            <div class="grid__column grid__column--12 control">
                                <label class="control__label">
                                    What are you looking to get from Only Balds? <small>(Select all that apply)</small>
                                </label>
                                <ul class="control" style="list-style: none; padding: 0; margin: 0;">
                                    <li>
                                        <label>
                                            <input type="checkbox" name="goals" value="Product recommendations">
                                            Product recommendations
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="goals" value="Education/tips">
                                            Education/tips
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="goals" value="Community support">
                                            Community support
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="goals" value="Fun/entertainment">
                                            Fun/entertainment
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="goals" value="Exclusive deals">
                                            Exclusive deals
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" name="goals" value="New product drops">
                                            New product drops
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            Something specific:
                                            <input type="text" name="goalsOther" class="control__input">
                                        </label>
                                    </li>
                                </ul>
                            </div>


                            <!-- Open to new products -->
                            <div class="grid__column grid__column--12 control">
                                <label class="control__label">Are you open to trying new products or routines?</label>
                                <div class="control">
                                    <label><input type="radio" name="newRoutine" value="Hell yes"> Hell yes</label>
                                    <label><input type="radio" name="newRoutine" value="Maybe"> Maybe</label>
                                    <label><input type="radio" name="newRoutine" value="Nah, I'm set"> Nah, I'm set</label>
                                </div>
                            </div>

                            <!-- Submit -->
                            <div class="grid__column grid__column--12 control">
                                <button id="submit-questionnaire" class="btn btn--blue" type="submit">Submit Questionnaire!</button>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div><!--/baldie questionnaire-->

<script src="/assets/scripts/App-5379555225.js"></script>
<script src="/assets/scripts/App-5379555225.js"></script>

<script>
$('#submit-questionnaire').click(async function(event) {
    event.preventDefault();

    let allValid = true;
    $('.required-input').each(function() {
        if ($(this).val() === "" || $(this).val() === "Select An Option") {
            allValid = false;
        }
    });
    if (!$('input[name="newRoutine"]:checked').length) allValid = false;

    if (!allValid) {
        alert("Please fill in all required fields.");
        return;
    }

    const $btn = $(this);
    $btn.html(`<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Sending...`);
    $btn.prop('disabled', true);

    try {
        const user = await $.ajax({ url: "/identity-information", method: "GET" });
        console.log(user);

        const accountId = crypto.randomUUID();
        const account = {
            id: accountId,
            hasSubmittedQuestionnaire: true,
            identityProviderId: user.claims.sub,
            firstName: $('#firstName').val(),
            lastName: $('#lastName').val(),
            displayName: $('#displayName').val(),
            address: $('#address').val(),
            email: user.claims.email,
            username: user.claims.nickname
        };

        const accountResponse = await $.ajax({
            url: "/onlybalds-api/accounts",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(account)
        });

        console.log("Account created successfully:", accountResponse);

        const answers = {
            id: crypto.randomUUID(),
            firstName: account.firstName,
            lastName: account.lastName,
            displayName: account.displayName,
            address: account.address,
            accountId: accountId,
            userId: user.claims.sub,
            data: {
                baldType: $('#baldType').val(),
                cleaningMethods: $('input[name="cleaningMethods"]:checked').map(function(){ return this.value }).get(),
                cleaningMethodsOther: $('#cleaningMethodsOther').val(),
                baldCareRoutine: $('#baldCareRoutine').val(),
                productsUsed: $('#productsUsed').val(),
                monthlySpend: $('#monthlySpend').val(),
                confidenceLevel: $('#confidenceLevel').val(),
                interests: $('input[name="interests"]:checked').map(function(){ return this.value }).get(),
                goals: $('input[name="goals"]:checked').map(function(){ return this.value }).get(),
                goalsOther: $('#goalsOther').val(),
                newRoutine: $('input[name="newRoutine"]:checked').val()
            }
        };

        console.log("QUESTIONNAIRE JSON TO POST:", JSON.stringify(answers, null, 2));

        const questionnaireResponse = await $.ajax({
            url: "/onlybalds-api/questionnaire",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(answers)
        });

        console.log("Questionnaire submitted successfully:", questionnaireResponse);
        $btn.html("Submit Questionnaire!");
        $btn.prop('disabled', false);
        window.location.replace('/');

    } catch (err) {
        console.error("Error submitting account or questionnaire:", err);
        $btn.html("Submit Questionnaire!");
        $btn.prop('disabled', false);
    }
});
</script>
