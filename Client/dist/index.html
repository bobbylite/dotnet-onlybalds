<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + React</title>
    <script type="module" crossorigin src="/assets/index-DtSgQokD.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-SvJWS2w9.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body style="background-color: #fffcf1;">
    <div class="container py-5">
      <div class="text-center">
        <img src="img/OnlyBalds-CircleLogo.webp" alt="OnlyBalds Logo" class="img-fluid mb-4" style="max-width: 300px;">
      </div>
      <h2 class="text-center mb-4">Welcome to the OnlyBalds Ecosystem!</h2>

      <div class="text-center mb-4">
        <a href="/auth/login" class="btn btn-secondary rounded-pill">Login</a>
      </div>

      <!-- Tabs -->
      <ul class="nav nav-pills justify-content-center mb-4" id="spa-tabs">
        <li class="nav-item"><a class="nav-link active" data-tab="marketplace">Marketplace</a></li>
        <li class="nav-item"><a class="nav-link" data-tab="chat">Chat Room</a></li>
        <li class="nav-item"><a class="nav-link" data-tab="forums">Forums</a></li>
        <li class="nav-item"><a class="nav-link" data-tab="tour">Take a Tour</a></li>
      </ul>

      <!-- Spinner -->
      <div id="spinner" class="text-center my-5" style="display:none;">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- Dynamic Content Container -->
      <div id="tab-content" class="fade-in"></div>
    </div>

    <script>
      // Suppress ResizeObserver errors globally
      const resizeObserverErrorHandler = (error) => {
          if (error.message && error.message.includes('ResizeObserver loop')) {
              return;
          }
      };

      window.addEventListener('error', (event) => {
          if (event.message && event.message.includes('ResizeObserver loop')) {
              event.stopImmediatePropagation();
          }
      });
      window.addEventListener('error', resizeObserverErrorHandler);
      window.addEventListener('unhandledrejection', resizeObserverErrorHandler);

      // Handles the onLoad event.
      const onLoad = () => {
          $('.navbar-collapse').collapse('hide');
      };

      // Initializes the Ecwid marketplace widget.
      const initializeMarketplace = (elementId) => {
          $(document).ready(async function() {
              const currentUrl = window.location.href;
              if (!currentUrl.includes("#ecwid")) {
                  window.location.href = currentUrl + "#ecwid";
                  window.location.reload();
                  return;
              }

              const storeId = '103074754';
              const scriptUrl = `https://app.ecwid.com/script.js?${storeId}&data_platform=code&data_date=${Date.now()}`;
              let container = document.getElementById(elementId);

              if (container) {
                  container.innerHTML = '';
                  if (container.hasAttribute('data-v-app')) {
                      container.removeAttribute('data-v-app');
                  }
              } else {
                  console.error(`Container with ID "${elementId}" not found.`);
                  return;
              }

              const loadWidget = () => {
                  xProductBrowser(
                      "categoriesPerRow=3",
                      "views=grid(20,3) list(60) table(60)",
                      "categoryView=grid",
                      "searchView=list",
                      `id=${elementId}`
                  );
                  console.log("Marketplace initialized.");
              };

              const loadScript = () => {
                  return new Promise((resolve, reject) => {
                      const scriptElement = document.createElement('script');
                      scriptElement.src = scriptUrl;
                      scriptElement.charset = 'utf-8';
                      scriptElement.setAttribute('data-cfasync', 'false');
                      scriptElement.onload = resolve;
                      scriptElement.onerror = reject;
                      document.head.appendChild(scriptElement);
                  });
              };

              const existingScript = document.querySelector(`script[src^="https://app.ecwid.com/script.js?${storeId}"]`);

              try {
                  if (existingScript) {
                      loadWidget();
                      return;
                  }
                  await loadScript();
                  loadWidget();
              } catch (error) {
                  console.error("Failed to load the Ecwid script:", error);
              }
          });
      };

      // Unloads the Ecwid account components.
      const unloadEcwidAccountComponents = () => {
          console.log(`location changed -> ${location}`);
      };

      // Determines if the browser is a mobile browser.
      const isMobileBrowser = () => {
          return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      };
      const tabContent = {
        marketplace: `
          <div id="ecwid-marketplace"></div>
          <script>
            initializeMarketplace("ecwid-marketplace");
          <\/script>
        `,
        chat: `
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Chat Room</h5>
              <img src="img/OnlyBalds-Chatroom.webp" class="img-fluid mb-3 bg-light" alt="Chat Room" />
              <p>Connect with the community in real-time, share tips, stories, and more.</p>
              <a href="ChatRoom" class="btn btn-primary rounded-pill">Join the Chat</a>
            </div>
          </div>
        `,
        forums: `
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Forums</h5>
              <img src="img/OnlyBalds-SoloLaptop.webp" class="img-fluid mb-3 bg-light" alt="Forums" />
              <p>Engage in discussions, ask questions, and get answers.</p>
              <a href="threads" class="btn btn-primary rounded-pill">Visit the Forums</a>
            </div>
          </div>
        `,
        tour: `
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Take a Tour</h5>
              <img src="img/OnlyBalds-DiscoverServices.webp" class="img-fluid mb-3 bg-light" alt="Tour" />
              <p>Discover additional services and features exclusively for you.</p>
              <a href="about" class="btn btn-primary rounded-pill">Explore</a>
            </div>
          </div>
        `
      };

      function loadTab(tabName) {
        $('#spinner').show();
        $('#tab-content').hide();

        setTimeout(() => {
          $('#tab-content').html(tabContent[tabName] || '<p class="text-danger">Content not found.</p>');
          $('#spinner').hide();
          $('#tab-content').fadeIn();

          // If the marketplace tab is loaded, re-run the initializer
          if (tabName === 'marketplace' && typeof initializeMarketplace === 'function') {
            initializeMarketplace("ecwid-marketplace");
          }
        }, 800); // Simulated delay
      }

      $(document).ready(function () {
        // Handle tab switching
        $('#spa-tabs .nav-link').on('click', function () {
          $('#spa-tabs .nav-link').removeClass('active');
          $(this).addClass('active');

          const tabName = $(this).data('tab');
          loadTab(tabName);
        });

        // Load default tab
        loadTab('marketplace');
      });
    </script>
  </body>
</html>
